## Next.js란?

    - 웹 어플리케이션을 만들기 위한 React framework 이다.
        - React : UI를 손쉽게 만들기 위해서 사용하는 JavaScript library
            - React로 만든 어플리케이션은 SPA로 간주된다.
                - SPA
                    - (페이지에 접근할때 일어날때마다 서버에 새로운 페이지를 요청해서 새로운 html 파일을 받아와서 다시 페이지가 reloading 되는 방식이 아닌) 하나의 페이지 어플리케이션 내에서 **필요한 부분(automatic code-splitting)**만 즉각적으로 업데이트 해주는 방식이다.
                        - 필욯나 부분만 조금씩 잘라서 보내니까 웹 사이트를 로딩하는 속도가 빠르다.
                - React Router
                    - 라이브러리
                    - 브라우져 주소창에 페이지 이동이 일어나는 것 처럼 업데이트 하기 위해 사용한다.
            - React를 사용하고 SPA로 구현한다면 다 CSR이 된다고 간주해 볼 수 있다.

    - React를 베이스로 해서 web application을 만드는데 필요한 전체적인 solution을 제공해 준다.
        1. FE 뿐만 아니라 fullstack을 만들어 볼 수 있게 해준다.
        2. file-based routing
        3. SEO, Image, Font에 대한 최적화된 solution을 제공해 준다.
        4. Server SIde Rendering을 가능하게 해준다.
            - 하이브리드 렌더링도 가능하게 해준다.
        5. 배포를 손쉽게 해준다.
        - 즉! 리액트로 웹앱을 개발하는데 리액트 만으로는 힘든 위의 것들을 가능하게 해준다.

    - 나아가 Next.js 13 부터는 더 많은것들을 제공하고 있다.
        - new routing(/app), (nested) layouts, server components, streaming, new toolchain(Turbopack)

## CSR

    - html 파일, React 라이브러리 자체, 소스 코드를 서버로부터 클라이언트 측에서 다운로드 받은후, 클라이언트 측에서 DOM 요소로 변화해서 브라우져에 표기하는 것


    1. 텅 빈 HTML 파일을 먼저 보내준다. (실제로 보면 body 부분에 id root인 div 태그 하나 있다. )

    2. 이후 서버에서 React, JS 까지 모두 받아 다운로드 되어야만 클라이언트 측에서 보여줄 준비가 된다.

    - CSR 장점
        - 한번 로딩 되면, 그 이후 부터는 빠른 UX 제공
            - 부분적인 업데이트를 하기 때문
                → 서버의 부하가 적다.

        - 한 페이지 안에서 어플리케이션을 이용할 수 있다.

    - CSR 단점
        - 페이지 로딩 시간 (TTV)이 길다.
        - HTML에는 UI가 하나도 없기 떄문에 자바스크립트 활성화가 필수(react, js 코드가 필수이다.)이다.
        - 또한 UI 요소가 HTML에 없기 때문에 SEO 최적화가 힘들다. → 크롤러가 무슨 내용인지 파악하기 힘들다.
        - 클라이언트에 모든 코드를 다운받기 때문에 보안에 취약하다.
        - CDN(content delivery network)에 캐시가 안된다.

            → 이런 문제점을 해결하기 위해 나온게 Next.js 프레임워크이고,  Next.js 프레임워크를 사용하면 `SSG`와 `SSR` 할 수 있다. → CSR이 가지고 있는 문제점들을 보완 / 해결 할 수 있다.

## SSG

    - Static Site Generation (정적 사이트 생성)
    - 렌더링 하는 주체가 서버인데, 언제 렌더링 되는지에 따라서 SSG인지 SSR인지가 달라진다.
        - SSG : 어플리케이션을 서버에 배포해서 처음으로 빌드할때 렌더링 된다. (영원한 static site이다.)
            - HTML 파일을 서버측에서 미리 만들어 두어서 HTML을 받아오기 때문에 다음에 사용자가 홈페이지에 접속하면 이제는 서버까지 가지 않아도 CDN에 캐시된 html 파일을 빠르게 가져올 수 있다.

        - SSG 장점
          1. 페이지 로딩 시간(TTV)이 빠름
          2. 자바스크립트 필요 없음
          3. SEO 최적화가 좋은
          4. 보안이 뛰어남
          5. CDN에 캐시가 됨

            - 하지만 빌드할때 렌더링 된다는 점 때문에 문제점이 생긴다.

        - SSG 단점
            - 데이터가 정적이다.
                - SSG는 데이터가 정적인(잘 바뀌지 않은) 웹 사이트에서는 적합할 수 있으나 데이터가 가변적으로 바뀌는 웹 사이트라면 맞지 않는다.
            - 빌드한때 렌더링하여 만들어 놓기 때문에 사용자별 다른 정보 제공이 어렵다. (로그인이 되는 서비스일 경우)
            - 즉, 모든 사용자들에서 동일한 정적인 데이터일 경우에는 유용할 수 있으나 그 외의 상황에서는 아니다.

            → 이 문제점을 해결하기 위해 ISR, SSR이 나왔다.

## ISR

    - Incremental static regeneration
        - 주기적으로 정적 사이트를 재 생성 하는 방법이다.
        - 렌더링 하는 주체자가 서버이고 주기적(설정한 주기 만큼)으로 렌더링한다.
            - SSG와 동일한 원리이다.
            - 단, 정해진 주기에 따라 페이지를 다시 생성한다.

    - ISR 장점
        1. 페이지 로딩 시간(TTV)이 빠름
        2. 자바스크립트 필요 없음
        3. SEO 최적화가 좋은
        4. 보안이 뛰어남
        5. CDN에 캐시가 됨
        6. 데이터가 주기적으로 업데이트 된다.


    - ISR 단점
        1. 주기적으로 렌더링 해주나 여전히 실시간 데이터다 아니다.
        2. 여전히 사용자별 정보 제공이 어렵다.

        → 이런 문제점을 해결하기 위해 나온게 SSR이다.

## SSR (Next.js로 구현 가능)

    - server side rendering
    - 렌더링 하는 주체가 서버이고, 클라이언트가 `요청시`마다 서버에서 렌더링 하고 렌더링한 결과인 html 파일을 클라인언트에게 보내준다.

    1. 서버에 우리가 배포한 next.js 어플리케이션이 있다.
    2. 클라이언트가 홈페이지 요청하면 서버가 Next.js 에 있는 React와 js 읽어오고 다른 작업들을 해서 html 파일을 구성한다.
    3. 완성된 HTML 파일을 클라이언트에 보내준다.
    - 자세한 과정은 뒤에 Next.js에서 제공하는 hydration 부분에서 확인!

    - SSR 장점
        1. 페이지 로딩 시간(TTV)이 빠름
        2. 자바스크립트 필요 없음
        3. SEO 최적화가 좋은
        4. 보안이 뛰어남
        5. 데이터가 실시간으로 업데이트 된다.
        6. 사용자별 필요한 데이터를 사용한다.

        → 요청할 때 마다 서버에서 렌더링 되기 때문에 사용자별 필요한 데이터 사용 가능해짐

    - SSR 단점
        1. 요청할 때마다 서버에서 렌더링 해서 클라이언트에게 보내기 때문에 SSG ISR 과 비교했을때 비교적 느릴 수 있다.
            - 서버에 과부하가 걸릴 수 있다. (서버의 overhead가 높아진다.)

        2. CDN에 캐시가 안된다.

### 완벽한 렌더링 방식은 없다!

## Hydration

- `Next.js`에서 hybrid를 가능하게 하게 제공하는 기능이다.
- 성능 좋은 웹 앱을 만들기 위해 두 개 이상(CSR, SSG, ISR,SSR)의 랜더링 방식을 결합 시켜 사용할 수 있게 해준다.

  1. 클라이언트가 서버에 홈페이지를 요청한다.
  2. Next.js는 서버에서 필요한 것들을 받아와서 정적 HTML 페이지를 생성한다. = pre-rendering = 사용자에게 어떤 UI가 있는지 먼저 보여 줄 수 있다. 하지만 아직 js 코드가 포함 되어 있지 않았기 때문에 보여주기만 하고 인터렉션은 할 수 없는 상태이다.
  3. 이후 React 와 js 코드를 서버에서 받게 되면 정적 HTML 페이지가 hydration 된다. = 컴포넌트로 렌더링이 발생하게 된다. = 실제 리액트 컴포넌트가 되어 실제 기능하게 된다.

  - 2~3 간에 시간적 간극이 있다. = 사용자의 클릭이 반응하는데 시간이 걸린다.

  - 예전 버전의 next.js를 보면 웹 페이지를 보다가 순간적으로 깜빡이는 현상이 일어났다.
    - 이는 정적인 html 페이지를 실제 react 컴포넌트로 대체하는 과정에서 일어나는 문제이다.
    - `즉 정적인 HTML 페이지와 하이드레이션된 다음의 간극을 줄여가는 것이 관건이다.`

## Nextjs SSR 생각해볼 내용

- pre-rendering 된 html을 받을 수 있어서 사용자가 즉각적으로 볼 수 있어서 좋다.
  - 하지만 인터렉션을 할 수 있을때 까지의 시간적인 간극이 있다.
    - 이 간극을 줄이는 것이 관건이다. (hybrid를 이용해서 SSG 와 CSR을 적절히 섞는 것도 하나의 방법이다.)
    - 줄이지 않아도 사용자에게 명백하게 각극에 대해서 알려줄 수 있는가(로딩 등)가 key point가 된다.
